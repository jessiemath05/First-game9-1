<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jessie Mathï½œä¹˜ä»¥å¹¾åˆ†ä¹‹ä¸€</title>

  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Noto+Sans+TC:wght@400;600;700;900&family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#14172f; --muted:#7c879d; --line:#e5e7eb;
      --bg:#f8f9ff; --card:#fff; --shadow:0 12px 30px rgba(2,8,23,.08);
      --radius:16px; --safe:16px;
      --brand:#8944d9; --brand2:#fe5699; --accent:#FFD700;
      --good:#22c55e; --bad:#dc2626;
      --chip:#efeaff;
      --glass:rgba(255,255,255,.88);
      --glass2:rgba(255,255,255,.7);
      --deep:rgba(20,23,47,.62);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Plus Jakarta Sans","Noto Sans TC","Fredoka",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 600px at 18% 12%, rgba(137,68,217,.18), transparent 55%),
        radial-gradient(900px 600px at 82% 18%, rgba(254,86,153,.24), transparent 55%),
        linear-gradient(180deg, #fcfdff, var(--bg));
    }
    a{color:inherit; text-decoration:none}
    button{font-family:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:22px 16px 40px}

    header.hero{
      display:flex;gap:14px;align-items:center;justify-content:space-between;
      padding:12px 16px;border:1px solid rgba(229,231,235,.7);
      border-radius:24px;background:var(--glass);
      box-shadow:var(--shadow); backdrop-filter: blur(12px);
      position:sticky; top:12px; z-index:50;
    }
    .brand{display:flex;gap:12px;align-items:center; min-width:0;}
    .brandMark{
      width:48px;height:48px;border-radius:50%;
      display:grid;place-items:center;
      background:rgba(255,255,255,.75);
      border:1px solid rgba(229,231,235,.85);
      box-shadow:0 8px 16px rgba(20,23,47,.08);
      flex:0 0 auto;
      overflow:hidden;
      position:relative;
    }
    .brandMark img{
      width:90%; height:90%;
      object-fit:contain;
      display:block;
      filter: drop-shadow(0 6px 10px rgba(20,23,47,.12));
    }
    .title{min-width:0}
    .title h1{
      margin:0;
      font-size:18px; letter-spacing:.2px;
      line-height:1.15;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .title p{margin:3px 0 0;color:var(--muted);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .hero-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end;}
    .navBtns{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}

    @media (max-width: 720px){
      header.hero{gap:10px; align-items:flex-start}
      .title h1{font-size:16px}
      .title p{display:none}
      .brandMark{width:40px;height:40px}
    }

    .btn{
      border:0;cursor:pointer;
      padding:10px 16px;border-radius:14px;
      font-weight:700;letter-spacing:.5px;
      background:linear-gradient(135deg,var(--brand),#b453fe);
      color:#fff; box-shadow:0 12px 20px rgba(137,68,217,.28);
      transition:transform .12s ease, filter .12s ease;
      display:inline-flex;gap:8px;align-items:center;
      user-select:none; white-space:nowrap;
    }
    .btn:hover{transform:translateY(-2px); filter:saturate(1.05)}
    .btn:active{transform:translateY(0px); filter:saturate(.95)}
    .btn.ghost{background:#fff;color:var(--ink);border:1px solid var(--line);box-shadow:0 6px 14px rgba(20,23,47,.05);font-weight:700;}
    .btn.ghost:hover{transform:translateY(-1px); filter:saturate(1.02); box-shadow:0 8px 16px rgba(20,23,47,.08)}
    .btn.good{background:linear-gradient(135deg,#4ade80,#22c55e); box-shadow:0 12px 20px rgba(34,197,94,.28);}
    .btn.bad{background:linear-gradient(135deg,#f87171,#dc2626); box-shadow:0 12px 20px rgba(220,38,38,.28);}
    .btn.soft{
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.78));
      color:var(--ink); border:1px solid rgba(229,231,235,.85);
      box-shadow:0 8px 18px rgba(2,8,23,.06);
      font-weight:700;
    }
    .btn.tiny{padding:9px 12px;border-radius:14px;font-weight:800;letter-spacing:.2px}
    .btn.tiny i{font-size:14px}

    .screen{display:none; margin-top:16px;}
    .screen.active{display:block;}

    .card{
      background:var(--glass);
      border:1px solid rgba(229,231,235,.7);
      border-radius:26px;
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(12px);
    }
    .card-h{
      padding:14px 20px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(229,231,235,.7);
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.75));
    }
    .card-h .left{display:flex;gap:10px;align-items:center;min-width:0}
    .tag{
      font-size:12px;font-weight:700;
      padding:6px 12px;border-radius:999px;
      background:var(--chip); color:#6d28d9;
      display:inline-flex;gap:6px;align-items:center;
      border:1px solid rgba(137,68,217,.15);
      flex:0 0 auto;
    }
    .card-h h2{margin:0;font-size:16px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .card-b{padding:20px}
    @media (max-width: 720px){ .card-b{padding:16px} }

    .muted{color:var(--muted)}
    .small{font-size:13px}
    .sep{height:1px;background:rgba(229,231,235,.75); margin:12px 0}

    .introGrid{display:grid; gap:16px; grid-template-columns: 1.1fr .9fr;}
    @media (max-width: 900px){ .introGrid{grid-template-columns:1fr} }
    .panel{
      border:1px solid rgba(229,231,235,.7);
      border-radius:20px;
      background:rgba(255,255,255,.8);
      padding:16px;
      overflow:hidden;
    }
    .panel h3{margin:0 0 8px 0;font-size:16px; font-weight:700;}
    .inp{
      width:100%;
      padding:14px 16px;
      border-radius:16px;
      border:1px solid rgba(229,231,235,.9);
      background:#fff;
      outline:none;
      font-weight:700;
      font-size:14px;
      box-shadow:0 8px 16px rgba(2,8,23,.05);
    }
    .rules{margin:0; padding-left:20px; color:var(--muted); line-height:1.75; font-size:13px;}
    .chipsRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .pillMini{
      display:inline-flex;gap:8px;align-items:center;
      padding:8px 12px;border-radius:999px;background:#fff;border:1px solid var(--line);
      box-shadow:0 6px 12px rgba(2,8,23,.05);
      font-size:12px;color:var(--muted); font-weight:700;
    }
    .pillMini b{color:var(--ink); font-weight:800;}
    .pillMini i{color:var(--brand)}

    .menuGrid{display:grid; gap:16px; grid-template-columns: 1fr 1fr;}
    @media (max-width: 900px){ .menuGrid{grid-template-columns:1fr} }
    .seg{display:flex; gap:10px; flex-wrap:wrap;}
    .seg button{
      border:1px solid rgba(229,231,235,.85);
      background:#fff;
      border-radius:16px;
      padding:12px 16px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 8px 16px rgba(2,8,23,.06);
      display:inline-flex; gap:8px; align-items:center;
      user-select:none;
    }
    .seg button.active{
      border-color:rgba(137,68,217,.55);
      background:rgba(137,68,217,.08);
      box-shadow:0 10px 20px rgba(137,68,217,.15);
      color:var(--brand);
    }
    .seg button.active .small{color:var(--brand)}
    .levelCards{display:grid; gap:12px; grid-template-columns: repeat(3, 1fr);}
    @media (max-width: 900px){ .levelCards{grid-template-columns:1fr} }
    .lvl{
      border:1px solid rgba(229,231,235,.85);
      border-radius:22px;
      background:rgba(255,255,255,.9);
      padding:16px;
      box-shadow:0 8px 16px rgba(2,8,23,.06);
      cursor:pointer;
      transition:transform .12s ease;
    }
    .lvl:hover{transform:translateY(-2px); box-shadow:0 10px 20px rgba(2,8,23,.08);}
    .lvl.active{border-color:rgba(137,68,217,.55); background:rgba(137,68,217,.06); box-shadow:0 12px 22px rgba(137,68,217,.18)}
    .lvl b{display:block; font-size:15px; font-weight:700}
    .lvl .muted{margin-top:6px}

    .lb{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:18px;
      border:1px solid rgba(229,231,235,.85);
      background:#fff;
      box-shadow:0 8px 16px rgba(2,8,23,.06);
    }
    .lb th,.lb td{padding:12px 12px;font-size:13px;border-bottom:1px solid rgba(229,231,235,.8);text-align:left;}
    .lb th{background:rgba(137,68,217,.06); font-weight:800; color:#6d28d9}
    .lb tr:last-child td{border-bottom:0}
    .rankCell{width:54px; font-weight:800}

    .hudRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between}
    .hudLeft, .hudRight{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .timerPill{background:linear-gradient(135deg, rgba(255,215,0,.22), rgba(255,255,255,.9));border:1px solid rgba(255,215,0,.35);color:var(--ink);}
    .comboPill{background:linear-gradient(135deg, rgba(34,197,94,.18), rgba(255,255,255,.9));border:1px solid rgba(34,197,94,.30);color:var(--ink);}
    .dangerPill{background:linear-gradient(135deg, rgba(239,68,68,.16), rgba(255,255,255,.9));border:1px solid rgba(239,68,68,.28);color:var(--ink);}

    .timeBar{
      margin-top:12px;
      height:12px;
      border-radius:999px;
      background:rgba(229,231,235,.9);
      border:1px solid rgba(229,231,235,.9);
      overflow:hidden;
      box-shadow:0 8px 16px rgba(2,8,23,.05);
    }
    .timeFill{
      height:100%;
      width:100%;
      background:linear-gradient(90deg, rgba(137,68,217,.85), rgba(254,86,153,.85));
      border-radius:999px;
      transform-origin:left center;
      transition:transform .25s ease;
    }
    .timeFill.danger{
      background:linear-gradient(90deg, rgba(239,68,68,.9), rgba(255,215,0,.9));
      filter:saturate(1.05);
    }

    .toast{
      margin-top:14px;
      padding:14px;border-radius:18px;border:1px solid rgba(229,231,235,.75);
      background:rgba(255,255,255,.8);
      display:none;
      gap:10px;align-items:flex-start;
      box-shadow:0 10px 20px rgba(2,8,23,.08);
    }
    .toast .icon{
      width:36px;height:36px;border-radius:14px;display:grid;place-items:center;
      background:rgba(137,68,217,.12); color:#6d28d9; flex:0 0 auto;
      font-size:16px;
    }
    .toast b{font-size:15px; font-weight:700;}
    .toast.good{border-color:rgba(34,197,94,.3); background:rgba(240,253,245,.8)}
    .toast.good .icon{background:rgba(34,197,94,.12); color:#166534}
    .toast.bad{border-color:rgba(239,68,68,.3); background:rgba(254,242,242,.8)}
    .toast.bad .icon{background:rgba(239,68,68,.12); color:#7f1d1d}

    .qbox{
      margin-top:14px;
      border:1px solid rgba(229,231,235,.7);
      border-radius:24px;
      background:rgba(255,255,255,.85);
      padding:20px;
      box-shadow:0 10px 20px rgba(2,8,23,.06);
    }
    .qhead{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .badge{
      padding:6px 12px;border-radius:999px;font-size:12px;font-weight:700;
      background:rgba(137,68,217,.12);color:#6d28d9;border:1px solid rgba(137,68,217,.25)
    }
    .equation{
      font-size:30px;font-weight:900;
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
      margin-top:16px;
    }
    @media (max-width: 760px){ .equation{font-size:24px; margin-top:14px} }
    .equation .box{
      display:inline-flex;align-items:center;justify-content:center;
      min-width:76px;
      padding:10px 12px;border-radius:18px;
      border:1px solid rgba(229,231,235,.9);
      background:#fff;
      box-shadow:0 6px 14px rgba(2,8,23,.05);
    }
    .equation .op{color:var(--muted);font-size:20px;font-weight:800}
    .equation .mini{font-size:20px;color:var(--muted);font-weight:800}

    .frac{
      display:inline-grid;
      grid-template-rows:auto auto;
      align-items:center;
      justify-items:center;
      gap:4px;
      padding:6px 12px;
      border-radius:18px;
      border:1px solid rgba(229,231,235,.9);
      background:#fff;
      box-shadow:0 6px 14px rgba(2,8,23,.05);
      min-width:104px;
    }
    .frac .line{width:100%;height:3px;background:rgba(20,23,47,.2);border-radius:999px;}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}

    .quick{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 760px){ .quick{grid-template-columns:1fr} }
    .qbtn{
      border:1px solid rgba(229,231,235,.85);
      background:rgba(255,255,255,.95);
      border-radius:18px;
      padding:14px 16px;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 8px 16px rgba(2,8,23,.06);
      transition:transform .12s ease;
      user-select:none;
      text-align:left;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .qbtn:hover{transform:translateY(-2px); box-shadow:0 10px 20px rgba(2,8,23,.08);}
    .qbtn:active{transform:translateY(0)}
    .qbtn small{font-weight:800;color:var(--muted)}
    .qbtn.sel{
      border-color:rgba(137,68,217,.55);
      background:rgba(137,68,217,.06);
      box-shadow:0 12px 22px rgba(137,68,217,.16);
    }

    .overlay{
      position:fixed; inset:0;
      background:rgba(20,23,47,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:200;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(900px, 100%);
      border-radius:28px;
      background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.85));
      border:1px solid rgba(229,231,235,.7);
      box-shadow:0 30px 80px rgba(2,8,23,.25);
      overflow:hidden;
      backdrop-filter: blur(12px);
      position:relative;
    }
    .modal-h{
      padding:16px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(229,231,235,.8);
      background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.8));
    }
    .modal-h b{font-size:16px; font-weight:700}
    .modal-b{padding:20px}
    .stars{
      display:inline-flex; gap:8px; align-items:center;
      margin-top:10px;
      font-size:24px;
      color:var(--accent);
      text-shadow:0 8px 16px rgba(255,215,0,.25);
      font-weight:800;
    }
    @keyframes pop{0%{transform:scale(.98);opacity:.6}100%{transform:scale(1);opacity:1}}
    .pop{animation:pop .18s ease both}

    #fxCanvas{ position:fixed; inset:0; pointer-events:none; z-index:999; }

    /* L3 æ‹–æ‹‰é…å° */
    .slotRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px}
    .slot{
      width:110px;height:62px;border-radius:18px;
      border:3px dashed rgba(148,163,184,.55);
      display:grid;place-items:center;
      background:rgba(255,255,255,.75);
      color:rgba(20,23,47,.55); font-weight:900;
      position:relative;
      overflow:hidden;
    }
    .slot.filled{
      border-style:solid;
      border-color:rgba(137,68,217,.55);
      background:rgba(137,68,217,.10);
      color:var(--ink);
    }
    .slot.active{
      border-color:rgba(255,215,0,.65);
      box-shadow:0 0 0 6px rgba(255,215,0,.14);
    }
    .ghostDrag{
      position:fixed;
      width:40px;height:40px;border-radius:14px;
      background:linear-gradient(135deg, rgba(255,215,0,.35), rgba(254,86,153,.30));
      border:1px solid rgba(255,215,0,.55);
      box-shadow:0 14px 26px rgba(2,8,23,.18);
      z-index:9999;
      pointer-events:none;
      display:grid; place-items:center;
      font-weight:900;
      color:rgba(20,23,47,.70);
      transform:translate(-50%,-50%);
    }
  </style>
</head>

<body>
  <canvas id="fxCanvas"></canvas>

  <div class="wrap">
    <header class="hero">
      <div class="brand">
        <div class="brandMark" title="Jessie Math">
          <img src="JESSIEMATH-Q.png" alt="Jessie Math Q" />
        </div>
        <div class="title">
          <h1>Jessie Mathï½œä¸»é¡Œä¹ ä¹˜ä»¥å¹¾åˆ†ä¹‹ä¸€</h1>
          <p>æŠŠã€Œå¹¾åˆ†ä¹‹ä¸€ã€å¾éœ§è£¡æ‹‰å›ç¾å¯¦ã€‚ä½ ä¸€æŒ‰ï¼Œä¸–ç•Œå°±æ¸…æ™°ã€‚âœ¨</p>
        </div>
      </div>

      <div class="hero-right">
        <div class="navBtns">
          <a class="btn ghost" href="https://jessiemath0703-chu.github.io/website2/" target="_blank" rel="noopener">
            <i class="fa-solid fa-house"></i><span>é¦–é </span>
          </a>
          <a class="btn ghost" href="https://jessiemath0703-chu.github.io/Game-Lobby/" target="_blank" rel="noopener">
            <i class="fa-solid fa-gamepad"></i><span>éŠæˆ²å¤§å»³</span>
          </a>
          <a class="btn ghost" href="https://jessiemath0703-chu.github.io/Game-Lobby/#g5-u9" target="_blank" rel="noopener" title="å›åˆ°å¹¾å¹´ç´š / ä¸»é¡Œ">
            <i class="fa-solid fa-layer-group"></i><span>äº”å¹´ç´šä¹˜ä»¥å¹¾åˆ†ä¹‹ä¸€</span>
          </a>

          <button class="btn ghost" id="btnSound" title="éŸ³æ•ˆé–‹é—œ">
            <i class="fa-solid fa-volume-high"></i><span id="soundText">éŸ³æ•ˆï¼šé–‹</span>
          </button>
        </div>
      </div>
    </header>

    <section class="screen active" id="screenIntro">
      <div class="card">
        <div class="card-h">
          <div class="left">
            <span class="tag"><i class="fa-solid fa-id-card"></i> ç¬¬ä¸€æ­¥</span>
            <h2>å…ˆè¼¸å…¥åå­—ï¼ˆå¿…å¡«ï¼‰</h2>
          </div>
          <span class="tag" style="background:rgba(255,215,0,.18); color:#7c2d12; border-color:rgba(255,215,0,.35)">
            <i class="fa-solid fa-hourglass-half"></i> 60 ç§’è¨ˆæ™‚
          </span>
        </div>
        <div class="card-b">
          <div class="introGrid">
            <div class="panel">
              <h3>ç©å®¶åå­—</h3>
              <input class="inp" id="nameInput" placeholder="ä¾‹å¦‚ï¼šå°å®‡ / å®‰å®‰ / Jessie ç²‰" maxlength="12" />
              <div class="sep"></div>
              <h3>éŠæˆ²è¦å‰‡ï¼ˆåªç•™æœ€å¿…è¦çš„ï¼‰</h3>
              <ul class="rules">
                <li>æ¯å›åˆ <b>60 ç§’</b>ï¼Œé¡Œç›®æœƒä¸€ç›´ <b>éš¨æ©Ÿå‡ºé¡Œ</b></li>
                <li>é€£çºŒç­”å°æœƒæœ‰ <b>Combo å€ç‡</b>ï¼Œè¶Šç©©è¶Šé¦™ ğŸ”¥</li>
                <li><b>æš«åœ</b>ï¼šæ™‚é–“åœæ­¢ã€é¡Œç›®é–ä½</li>
                <li><b>å›ä¸»é¸å–®</b>ï¼šç›´æ¥çµæŸæœ¬å±€ä½† <b>ä¸å¯«å…¥æ’è¡Œæ¦œ</b></li>
                <li>é“å…·ï¼šåªä¿ç•™ <b>åŠ å€</b>ï¼ˆä¸‹ä¸€é¡Œæ­£ç¢º Ã—2ï¼‰</li>
              </ul>
              <div class="sep"></div>
              <div class="chipsRow">
                <span class="pillMini"><i class="fa-solid fa-shuffle"></i> é¡Œç›®è¶…å¤š</span>
                <span class="pillMini"><i class="fa-solid fa-hand-pointer"></i> äº’å‹•æ›´å¤š</span>
                <span class="pillMini"><i class="fa-solid fa-ranking-star"></i> Top10</span>
              </div>
            </div>

            <div class="panel">
              <h3>æº–å‚™å¥½å°±èµ°</h3>
              <div class="muted small" style="line-height:1.75">
                åå­—åªç•™åœ¨ä½ çš„ç€è¦½å™¨ã€‚<br/>
                ä½ è¼¸å…¥çš„æ˜¯ä¸»è§’åï¼Œä¸æ˜¯è³‡æ–™ã€‚æ”¾å¿ƒã€‚âœ¨
              </div>
              <div class="sep"></div>
              <button class="btn good" id="btnGoMenu" style="width:100%; justify-content:center">
                <i class="fa-solid fa-door-open"></i> é€²å…¥é¸å–®
              </button>
              <div class="sep"></div>
              <div class="muted small">
                å°æé†’ï¼šåå­—æœ€å¤š 12 å€‹å­—ï¼Œæ’è¡Œæ¦œä¹Ÿè¦å–˜å£æ°£ã€‚
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <section class="screen" id="screenMenu">
      <div class="card">
        <div class="card-h">
          <div class="left">
            <span class="tag"><i class="fa-solid fa-compass"></i> ç¬¬äºŒæ­¥</span>
            <h2>é¸é—œå¡ & é¸é€Ÿåº¦</h2>
          </div>
          <div class="chipsRow">
            <span class="pillMini"><i class="fa-solid fa-user"></i> ç©å®¶ï¼š<b id="menuPlayer">â€”</b></span>
            <span class="pillMini"><i class="fa-solid fa-circle-info"></i> 60 ç§’ / Combo / æ˜Ÿç­‰</span>
          </div>
        </div>

        <div class="card-b">
          <div class="menuGrid">
            <div class="panel">
              <h3>é¸é—œå¡</h3>
              <div class="levelCards" id="levelCards"></div>

              <div class="sep"></div>
              <h3>é¸é€Ÿåº¦ï¼ˆé›£åº¦ï¼‰</h3>
              <div class="seg" id="diffSeg"></div>

              <div class="sep"></div>
              <div class="chipsRow">
                <button class="btn good" id="btnStart">
                  <i class="fa-solid fa-play"></i> é–‹å§‹ï¼ˆ60 ç§’ï¼‰
                </button>
                <button class="btn soft" id="btnBackName">
                  <i class="fa-solid fa-pen"></i> æ”¹åå­—
                </button>
              </div>
            </div>

            <div class="panel">
              <h3>æ’è¡Œæ¦œï¼ˆTop10ï¼‰</h3>
              <div class="muted small" id="lbHint" style="line-height:1.75; margin-bottom:10px">
                é¸å¥½é—œå¡èˆ‡é€Ÿåº¦å¾Œï¼Œé€™è£¡æœƒé¡¯ç¤ºå°æ‡‰çš„æ’è¡Œæ¦œã€‚
              </div>
              <table class="lb" aria-label="æ’è¡Œæ¦œ">
                <thead>
                  <tr>
                    <th style="width:54px">åæ¬¡</th>
                    <th>ç©å®¶</th>
                    <th style="width:120px">åˆ†æ•¸</th>
                  </tr>
                </thead>
                <tbody id="lbBody"></tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section class="screen" id="screenGame">
      <div class="card">
        <div class="card-h">
          <div class="left">
            <span class="tag" id="gameTag"><i class="fa-solid fa-flask"></i> LEVEL 1</span>
            <h2 id="gameTitle">â€”</h2>
          </div>
          <div class="chipsRow">
            <span class="pillMini timerPill"><i class="fa-solid fa-hourglass-half"></i> å€’æ•¸ <b id="timeLeft">60</b>s</span>
            <span class="pillMini"><i class="fa-solid fa-star"></i> åˆ†æ•¸ <b id="score">0</b></span>
            <span class="pillMini comboPill"><i class="fa-solid fa-fire"></i> Combo <b id="combo">0</b>ï¼ˆÃ—<b id="multi">1.0</b>ï¼‰</span>
            <span class="pillMini"><i class="fa-solid fa-user"></i> <b id="playerName">â€”</b></span>
          </div>
        </div>

        <div class="card-b">
          <div class="hudRow">
            <div class="hudLeft">
              <span class="tag" id="diffTag"><i class="fa-solid fa-gauge-high"></i> é€Ÿåº¦ï¼šæ¨™æº–</span>
              <span class="tag" style="background:rgba(255,215,0,.18); color:#7c2d12; border-color:rgba(255,215,0,.35)">
                <i class="fa-solid fa-check"></i> ç­”å°ï¼š<b id="correct">0</b>
              </span>
              <span class="tag" style="background:rgba(34,197,94,.12); color:#14532d; border-color:rgba(34,197,94,.28)">
                <i class="fa-solid fa-bolt"></i> é“å…· åŠ å€ <b id="toolDouble">2</b>
              </span>
            </div>

            <div class="hudRight">
              <button class="btn soft" id="btnPause"><i class="fa-solid fa-pause"></i> æš«åœ</button>
              <button class="btn" id="btnRestart"><i class="fa-solid fa-rotate-right"></i> é‡æ–°</button>
              <button class="btn ghost" id="btnQuit"><i class="fa-solid fa-arrow-left"></i> å›ä¸»é¸å–®</button>
            </div>
          </div>

          <div class="timeBar" aria-label="å€’æ•¸é€²åº¦">
            <div class="timeFill" id="timeFill"></div>
          </div>

          <div class="chipsRow" style="margin-top:12px">
            <button class="btn tiny" id="btnDouble"><i class="fa-solid fa-bolt"></i> åŠ å€</button>
            <span class="pillMini" id="doubleArmedPill" style="display:none">
              <i class="fa-solid fa-bolt"></i> ä¸‹ä¸€é¡Œæ­£ç¢ºï¼š<b>Ã—2</b>
            </span>
          </div>

          <div class="toast" id="toast">
            <div class="icon"><i class="fa-solid fa-comment-dots"></i></div>
            <div>
              <b id="toastTitle">è¨Šæ¯</b>
              <div class="muted small" id="toastBody">...</div>
            </div>
          </div>

          <div id="content"></div>
        </div>
      </div>
    </section>
  </div>

  <div class="overlay" id="pauseOverlay">
    <div class="modal pop" style="width:min(560px,100%)">
      <div class="modal-h">
        <div class="left" style="display:flex; gap:10px; align-items:center">
          <span class="tag"><i class="fa-solid fa-pause"></i> æš«åœä¸­</span>
          <b>æ™‚é–“å·²åœæ­¢ã€é¡Œç›®å·²é–ä½</b>
        </div>
        <span class="tag" style="background:rgba(255,215,0,.18); color:#7c2d12; border-color:rgba(255,215,0,.35)">
          <i class="fa-solid fa-hourglass-half"></i> <span id="pauseTime">60</span>s
        </span>
      </div>
      <div class="modal-b">
        <div class="muted small" style="line-height:1.8">
          ä¼‘æ¯ä¸€ä¸‹ä¹Ÿå¾ˆå¸¥ã€‚ä¸‹ä¸€é¡Œè¦åƒé¢¨ä¸€æ¨£ä¿è½ã€‚ğŸƒ
        </div>
        <div class="sep"></div>
        <div class="chipsRow" style="justify-content:center">
          <button class="btn" id="btnResume"><i class="fa-solid fa-play"></i> ç¹¼çºŒ</button>
          <button class="btn ghost" id="btnQuitNoSave"><i class="fa-solid fa-arrow-left"></i> å›ä¸»é¸å–®ï¼ˆä¸å¯«æ¦œï¼‰</button>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="resultOverlay">
    <div class="modal pop">
      <div class="modal-h">
        <div class="left" style="display:flex; gap:10px; align-items:center">
          <span class="tag"><i class="fa-solid fa-trophy"></i> æœ¬å±€çµç®—</span>
          <b id="resultTitle">â€”</b>
        </div>
        <span class="tag" id="resultMeta">â€”</span>
      </div>
      <div class="modal-b">
        <div class="introGrid">
          <div class="panel">
            <h3>ä½ çš„æˆç¸¾</h3>
            <div style="display:flex; gap:10px; align-items:baseline; flex-wrap:wrap">
              <div style="font-size:40px; font-weight:900" id="finalScore">0</div>
              <div class="muted">åˆ†</div>
            </div>
            <div class="sep"></div>
            <div class="chipsRow">
              <span class="pillMini"><i class="fa-solid fa-check"></i> ç­”å° <b id="finalCorrect">0</b></span>
              <span class="pillMini"><i class="fa-solid fa-fire"></i> æœ€é«˜ Combo <b id="finalCombo">0</b></span>
              <span class="pillMini"><i class="fa-solid fa-bolt"></i> ä½¿ç”¨åŠ å€ <b id="finalTools">0</b></span>
            </div>
            <div class="stars" id="starLine">â˜†â˜†â˜†</div>
            <div class="muted small" id="starHint" style="line-height:1.75">â€”</div>
          </div>

          <div class="panel">
            <h3>ä¸‹ä¸€æ­¥</h3>
            <div class="muted small" style="line-height:1.75">
              æœ¬å±€å·²å¯«å…¥æ’è¡Œæ¦œï¼ˆåªæœ‰ã€Œæ™‚é–“æ­¸é›¶æ­£å¸¸çµæŸã€æ‰æœƒå¯«æ¦œï¼‰ã€‚<br/>
              ä½ å‰›å‰›ä¸æ˜¯åœ¨ç®—é¡Œç›®ï¼Œä½ æ˜¯åœ¨ç·´ã€Œç©©ã€ã€‚å¾ˆé›£ï¼Œä½†å¾ˆç¾ã€‚
            </div>
            <div class="sep"></div>
            <div class="chipsRow">
              <button class="btn" id="btnPlayAgain"><i class="fa-solid fa-rotate-right"></i> åŒè¨­å®šå†ä¸€å±€</button>
              <button class="btn ghost" id="btnBackMenu"><i class="fa-solid fa-bars"></i> å›ä¸»é¸å–®</button>
            </div>
            <div class="sep"></div>
            <div class="muted small">
              æƒ³æ›´å¿«ï¼šå»é¸ã€Œæ¥µé€Ÿã€ã€‚æƒ³æ›´ç©©ï¼šç”¨ã€Œæ…¢é€Ÿã€æŠŠæ‰‹æ„Ÿé¤Šèµ·ä¾†ã€‚
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const $ = (s, el=document)=>el.querySelector(s);
    const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));

    /* ---------- éŸ³æ•ˆï¼ˆå¯é—œï¼‰ ---------- */
    let soundOn = true;
    function beep(type="good"){
      if(!soundOn) return;
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = "sine";
      const t = ctx.currentTime;
      const freq = type==="good" ? 660 : 220;
      o.frequency.setValueAtTime(freq, t);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.20, t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, t+0.18);
      o.start(t); o.stop(t+0.2);
      setTimeout(()=>ctx.close(), 260);
    }

    /* ---------- é›£åº¦ï¼ˆé€Ÿåº¦ï¼‰ ---------- */
    const DIFFS = [
      {id:"slow",  name:"æ…¢é€Ÿ",  base:10, comboStep:3, cap:2.0, icon:"fa-feather"},
      {id:"normal", name:"æ¨™æº–",  base:12, comboStep:3, cap:2.3, icon:"fa-bolt"},
      {id:"fast",  name:"æ¥µé€Ÿ",  base:14, comboStep:2, cap:2.6, icon:"fa-jet-fighter-up"},
    ];

    /* ---------- å°å·¥å…· ---------- */
    const randInt = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
    function gcd(a,b){
      a=Math.abs(a); b=Math.abs(b);
      while(b){ [a,b]=[b,a%b]; }
      return a||1;
    }
    function reduceFrac(n,d){
      const g = gcd(n,d);
      return {n:n/g, d:d/g};
    }
    function sameFrac(A,B){ return A.n===B.n && A.d===B.d; }
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }
    function fracHTML(n,d){
      return `<span class="frac"><div style="font-weight:900">${n}</div><div class="line"></div><div style="font-weight:900">${d}</div></span>`;
    }
    function fracText(n,d){ return `${n}/${d}`; }

    /* ---------- ç‹€æ…‹ ---------- */
    const state = {
      screen:"intro",
      player:"",
      level:1,
      diff:"normal",

      mode:"menu",
      timeLeft:60,
      timerId:null,
      paused:false,

      score:0,
      correct:0,
      combo:0,
      bestCombo:0,

      tools:{ dbl:2, used:0, dblArmed:false },

      // âœ… L1ï¼šåˆ†æ•¸ Ã· æ•´æ•¸ï¼ˆé¸æ“‡é¡Œï¼‰
      l1:{ p:3, q:4, k:2, ans:{n:3,d:8}, options:[], pick:null },

      // âœ… L2ï¼šæ•´æ•¸ Ã— å¹¾åˆ†ä¹‹å¹¾ï¼ˆé¸æ“‡é¡Œï¼‰
      l2:{ m:6, a:3, b:4, ans:{n:9,d:2}, options:[], pick:null },

      // L3ï¼šæ‹–æ‹‰é…å°
      l3:{ x:28, match:{ cards:[], slots:{A:null,B:null} } }
    };

    function showScreen(key){
      state.screen = key;
      $("#screenIntro").classList.toggle("active", key==="intro");
      $("#screenMenu").classList.toggle("active", key==="menu");
      $("#screenGame").classList.toggle("active", key==="game");
    }
    function getDiff(){ return DIFFS.find(d=>d.id===state.diff) || DIFFS[1]; }
    function comboMultiplier(){
      const d = getDiff();
      const m = 1 + Math.floor(state.combo / d.comboStep) * 0.1;
      return Math.min(d.cap, Number(m.toFixed(1)));
    }

    function setToast(kind, title, body){
      const t = $("#toast");
      t.className = "toast " + (kind || "");
      $("#toastTitle").textContent = title;
      $("#toastBody").innerHTML = body;
      t.style.display = "flex";
      t.classList.remove("pop");
      void t.offsetWidth;
      t.classList.add("pop");
    }
    function hideToast(){ $("#toast").style.display = "none"; }

    function updateToolsHUD(){
      $("#toolDouble").textContent = state.tools.dbl;
      $("#doubleArmedPill").style.display = state.tools.dblArmed ? "inline-flex" : "none";
    }
    function updateGameHUD(){
      $("#timeLeft").textContent = state.timeLeft;
      $("#score").textContent = state.score;
      $("#combo").textContent = state.combo;
      $("#multi").textContent = comboMultiplier().toFixed(1);
      $("#correct").textContent = state.correct;
      $("#playerName").textContent = state.player || "â€”";
      $("#pauseTime").textContent = state.timeLeft;

      const d = getDiff();
      $("#diffTag").innerHTML = `<i class="fa-solid fa-gauge-high"></i> é€Ÿåº¦ï¼š${d.name}`;

      const pill = $("#timeLeft").closest(".pillMini");
      pill.classList.toggle("dangerPill", state.mode==="play" && state.timeLeft<=10);

      const ratio = Math.max(0, Math.min(1, state.timeLeft/60));
      const fill = $("#timeFill");
      fill.style.transform = `scaleX(${ratio})`;
      fill.classList.toggle("danger", state.timeLeft<=10 && state.mode==="play");

      updateToolsHUD();
    }

    function setGameHeader(){
      const t = $("#gameTag");
      const h = $("#gameTitle");
      if(state.level===1){
        t.innerHTML = `<i class="fa-solid fa-flask"></i> LEVEL 1`;
        h.textContent = "åˆ†æ•¸ Ã· æ•´æ•¸ï½œé¸å‡ºæ­£ç¢ºç­”æ¡ˆ";
      }else if(state.level===2){
        t.innerHTML = `<i class="fa-solid fa-layer-group"></i> LEVEL 2`;
        h.textContent = "æ•´æ•¸ Ã— å¹¾åˆ†ä¹‹å¹¾ï½œé¸å‡ºæ­£ç¢ºç­”æ¡ˆ";
      }else{
        t.innerHTML = `<i class="fa-solid fa-mirror"></i> LEVEL 3`;
        h.textContent = "æ‹–æ‹‰é…å°ï½œæŠŠèªæ„æ‹–åˆ°ç®—å¼ä½ç½®";
      }
    }

    /* =========================================================
      æ’è¡Œæ¦œï¼ˆlocalStorageï¼‰
    ========================================================= */
    const LB_KEY = "JM_T9_LEADERBOARD_V7"; // âœ… æ›´æ–°ç‰ˆè™Ÿï¼Œé¿å…èˆŠæ¦œå¹²æ“¾
    const lbKey = (level,diff)=>`${LB_KEY}::L${level}::${diff}`;
    function loadLB(level, diff){
      try{
        const raw = localStorage.getItem(lbKey(level,diff));
        return raw ? JSON.parse(raw) : [];
      }catch(e){ return []; }
    }
    function saveLB(level, diff, items){
      try{ localStorage.setItem(lbKey(level,diff), JSON.stringify(items)); }catch(e){}
    }
    function pushLB(level, diff, item){
      const arr = loadLB(level,diff);
      arr.push(item);
      arr.sort((a,b)=>b.score-a.score);
      const top10 = arr.slice(0,10);
      saveLB(level,diff, top10);
      return top10;
    }

    /* =========================================================
      è¨ˆåˆ†
    ========================================================= */
    function award(isCorrect){
      if(isCorrect){
        const d = getDiff();
        state.combo += 1;
        state.bestCombo = Math.max(state.bestCombo, state.combo);
        state.correct += 1;

        let add = Math.round(d.base * comboMultiplier());
        if(state.tools.dblArmed){
          add *= 2;
          state.tools.dblArmed = false;
          setToast("good","åŠ å€å‘½ä¸­ï¼",`åƒé–ƒé›»ä¸€æ¨£å‰›å¥½ï¼šæœ¬é¡ŒåŠ å€ <b>+${add}</b> âš¡`);
          fxConfetti(22);
        }else{
          if(state.combo>0 && state.combo%8===0) fxConfetti(16);
        }
        state.score += add;
        beep("good");
      }else{
        state.combo = 0;
        state.score = Math.max(0, state.score - 3);
        state.tools.dblArmed = false;
        beep("bad");
      }
      updateGameHUD();
    }

    /* =========================================================
      60 ç§’å›åˆæ§åˆ¶
    ========================================================= */
    function stopTimer(){
      if(state.timerId){ clearInterval(state.timerId); state.timerId=null; }
    }
    function startTimer(){
      stopTimer();
      state.timerId = setInterval(()=>{
        if(state.mode!=="play") return;
        if(state.paused) return;
        state.timeLeft -= 1;
        updateGameHUD();
        if(state.timeLeft<=0) endRound(true);
      }, 1000);
    }
    function resetTools(){
      state.tools.dbl = 2;
      state.tools.used = 0;
      state.tools.dblArmed = false;
    }
    function startRound(){
      state.mode = "play";
      state.paused = false;
      state.timeLeft = 60;
      state.score = 0;
      state.correct = 0;
      state.combo = 0;
      state.bestCombo = 0;

      resetTools();
      hideToast();
      showScreen("game");
      setGameHeader();
      updateGameHUD();

      setToast("", "é–‹å±€ï¼", "60 ç§’é–‹å§‹å€’æ•¸ã€‚ä½ é¸çš„ä¸åªæ˜¯ç­”æ¡ˆï¼Œæ˜¯ä½ è…¦è¢‹çš„å…‰ã€‚âœ¨");
      newQuestion();
      startTimer();
    }
    function pauseRound(){
      if(state.mode!=="play") return;
      state.paused = true;
      state.mode = "paused";
      $("#pauseOverlay").classList.add("show");
      updateGameHUD();
      setToast("", "å·²æš«åœ", "æ™‚é–“åœæ­¢ã€é¡Œç›®é–ä½ã€‚");
    }
    function resumeRound(){
      if(state.mode!=="paused") return;
      state.paused = false;
      state.mode = "play";
      $("#pauseOverlay").classList.remove("show");
      updateGameHUD();
      setToast("", "ç¹¼çºŒï¼", "å›åˆ°ç¯€å¥ï¼Œåƒå¿ƒè·³ä¸€æ¨£ç©©ã€‚");
    }

    function calcStars(score, diff){
      const map = {
        slow:  [95,180,270],
        normal:[110,205,300],
        fast:  [125,230,330],
      };
      const t = map[diff] || map.normal;
      if(score >= t[2]) return 3;
      if(score >= t[1]) return 2;
      if(score >= t[0]) return 1;
      return 0;
    }

    function endRound(saveToLB){
      stopTimer();
      state.paused = false;
      $("#pauseOverlay").classList.remove("show");

      if(!saveToLB){
        state.mode = "menu";
        showScreen("menu");
        renderMenu();
        return;
      }

      state.mode = "result";
      const d = getDiff();
      const star = calcStars(state.score, state.diff);
      const starText = "â˜…".repeat(star) + "â˜†".repeat(3-star);
      $("#starLine").textContent = starText;

      const hint =
        star===3 ? "â˜…â˜…â˜… ä½ æŠŠéœ§ç›´æ¥åŠˆé–‹äº†ï¼Œä¹¾æ·¨ä¿è½ã€‚" :
        star===2 ? "â˜…â˜…â˜† å¾ˆç©©ã€‚å†å¤šä¸€é»é€£æ“Šï¼Œæ˜Ÿæ˜Ÿæœƒè‡ªå·±è¿½ä¸Šä½ ã€‚" :
        star===1 ? "â˜…â˜†â˜† ä½ åœ¨è·¯ä¸Šã€‚ä¸‹ä¸€å±€æŠŠç¯€å¥æŠ“ä½å°±æœƒèµ·é£›ã€‚" :
                  "â˜†â˜†â˜† å…ˆåˆ¥æ€•ã€‚ä½ åªæ˜¯é‚„æ²’æŠŠéœ§æ’•é–‹ã€‚";
      $("#starHint").textContent = hint;

      $("#resultTitle").textContent = `${state.player} çš„æœ¬å±€æˆç¸¾`;
      $("#resultMeta").textContent = `LEVEL ${state.level}ï½œ${d.name}ï½œ60 ç§’`;
      $("#finalScore").textContent = state.score;
      $("#finalCorrect").textContent = state.correct;
      $("#finalCombo").textContent = state.bestCombo;
      $("#finalTools").textContent = state.tools.used;

      pushLB(state.level, state.diff, {
        name: state.player,
        score: state.score,
        correct: state.correct,
        bestCombo: state.bestCombo,
        toolsUsed: state.tools.used,
        ts: Date.now()
      });

      $("#resultOverlay").classList.add("show");
      fxConfetti(34);
    }

    /* =========================================================
      é¸å–®æ¸²æŸ“
    ========================================================= */
    function renderMenu(){
      showScreen("menu");
      $("#menuPlayer").textContent = state.player || "â€”";

      const levelWrap = $("#levelCards");
      const levels = [
        {id:1, title:"åˆ†æ•¸ Ã· æ•´æ•¸", sub:"é¸å‡ºæ­£ç¢ºç­”æ¡ˆï¼ˆåŒ–ç°¡ï¼‰", icon:"fa-flask"},
        {id:2, title:"æ•´æ•¸ Ã— å¹¾åˆ†ä¹‹å¹¾", sub:"é¸å‡ºæ­£ç¢ºç­”æ¡ˆï¼ˆåŒ–ç°¡ï¼‰", icon:"fa-layer-group"},
        {id:3, title:"æ‹–æ‹‰é…å°", sub:"èªæ„æ‹–åˆ°ç®—å¼ä½ç½®", icon:"fa-mirror"},
      ];
      levelWrap.innerHTML = levels.map(l=>`
        <div class="lvl ${l.id===state.level?'active':''}" data-level="${l.id}">
          <span class="tag"><i class="fa-solid ${l.icon}"></i> LEVEL ${l.id}</span>
          <b style="margin-top:8px">${l.title}</b>
          <div class="muted small">${l.sub}</div>
        </div>
      `).join("");

      $$("#levelCards .lvl").forEach(el=>{
        el.addEventListener("click", ()=>{
          state.level = Number(el.dataset.level);
          renderMenu();
        });
      });

      const diffSeg = $("#diffSeg");
      diffSeg.innerHTML = DIFFS.map(d=>`
        <button class="${d.id===state.diff?'active':''}" data-diff="${d.id}">
          <i class="fa-solid ${d.icon}"></i>${d.name}
          <span class="muted small">ï¼ˆåŸºç¤åˆ† ${d.base}ï¼‰</span>
        </button>
      `).join("");
      $$("#diffSeg button").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.diff = btn.dataset.diff;
          renderMenu();
        });
      });

      const d = getDiff();
      $("#lbHint").innerHTML = `ç›®å‰é¡¯ç¤ºï¼š<b>LEVEL ${state.level}</b>ï½œ<b>${d.name}</b>ï¼ˆTop10ï¼‰`;
      const lb = loadLB(state.level, state.diff);
      const rows = lb.length ? lb.map((r, idx)=>{
        const date = new Date(r.ts);
        const mm = String(date.getMonth()+1).padStart(2,"0");
        const dd = String(date.getDate()).padStart(2,"0");
        return `
          <tr>
            <td class="rankCell">#${idx+1}</td>
            <td>
              <b>${escapeHtml(r.name)}</b>
              <div class="muted small">${mm}/${dd}ï½œCombo ${r.bestCombo}${typeof r.toolsUsed==="number" ? `ï½œåŠ å€ ${r.toolsUsed}` : ""}</div>
            </td>
            <td><b>${r.score}</b><div class="muted small">ç­”å° ${r.correct}</div></td>
          </tr>
        `;
      }).join("") : `<tr><td colspan="3" class="muted">ç›®å‰é‚„æ²’æœ‰äººä¸Šæ¦œï¼ˆä½ å¯ä»¥ç•¶ç¬¬ä¸€å€‹ï¼‰ã€‚</td></tr>`;
      $("#lbBody").innerHTML = rows;
    }

    /* =========================================================
      é¡Œç›®ç”Ÿæˆï¼ˆâœ… L1 åˆ†æ•¸Ã·æ•´æ•¸ã€âœ… L2 æ•´æ•¸Ã—åˆ†æ•¸ï¼‰
    ========================================================= */
    function genL1(){
      // åˆ†æ•¸ p/q Ã· k = p/(qk)ï¼ˆå†åŒ–ç°¡ï¼‰
      let q = randInt(2,12);
      let p = randInt(1,q-1);
      let k = randInt(2,6);

      // é¿å…å¤ªå–®èª¿ï¼šå¶çˆ¾åšæˆå¯åŒ–ç°¡ï¼ˆæ•…æ„ï¼‰
      if(Math.random()<0.35){
        const t = randInt(2,3);
        p = Math.min(q-1, p*t);
        q = q*t;
      }

      const ans = reduceFrac(p, q*k);

      // ç”¢ç”Ÿå¹²æ“¾é¸é …
      const d1 = reduceFrac(p, q);         // å¿˜è¨˜é™¤ä»¥æ•´æ•¸
      const d2 = reduceFrac(p, q+k);       // äº‚åŠ 
      const d3 = reduceFrac(p, q*randInt(2,6)); // äº‚ä¹˜åˆ†æ¯
      const pool = [ans, d1, d2, d3].filter((x,i,arr)=>arr.findIndex(y=>sameFrac(x,y))===i);

      // ä¸å¤ å°±è£œ
      while(pool.length<4){
        const nx = reduceFrac(randInt(1,10), randInt(2,30));
        if(!pool.some(t=>sameFrac(t,nx))) pool.push(nx);
      }

      state.l1 = { p, q, k, ans, options: shuffle(pool).slice(0,4), pick:null };
    }

    function genL2(){
      // æ•´æ•¸ m Ã— (a/b) = (ma)/bï¼ˆå†åŒ–ç°¡ï¼‰
      let b = randInt(2,12);
      let a = randInt(1,b-1);
      let m = randInt(2,12);

      // å¶çˆ¾çµ¦ã€Œä¹˜ä»¥å¹¾åˆ†ä¹‹ä¸€ã€æ„Ÿï¼ša=1
      if(Math.random()<0.35){
        a = 1;
        b = randInt(2,12);
      }

      const ans = reduceFrac(m*a, b);

      // å¹²æ“¾é¸é …
      const d1 = reduceFrac(m, b);         // æŠŠ a å¿˜äº†
      const d2 = reduceFrac(m*a, b+a);     // äº‚åŠ åˆ†æ¯
      const d3 = reduceFrac(m+b, b);       // äº‚åŠ æ•´æ•¸
      const pool = [ans, d1, d2, d3].filter((x,i,arr)=>arr.findIndex(y=>sameFrac(x,y))===i);

      while(pool.length<4){
        const nx = reduceFrac(randInt(1,30), randInt(2,30));
        if(!pool.some(t=>sameFrac(t,nx))) pool.push(nx);
      }

      state.l2 = { m, a, b, ans, options: shuffle(pool).slice(0,4), pick:null };
    }

    function genL3(){
      const x0 = randInt(6,30);
      const x = (x0%2===0) ? x0 : x0+1;
      state.l3.x = x;

      const half = x/2;
      const cards = shuffle([
        {id:"c1", text:`å¾ ${x} æ‹¿èµ°ä¸€åŠ`, ok:"mul"},
        {id:"c2", text:`æŠŠ ${x} å¹³å‡åˆ†æˆ 2 ä»½`, ok:"div"},
        {id:"c3", text:`æ¯ä»½æ˜¯ ${half}ï¼ˆçµæœæè¿°ï¼‰`, ok:"both"},
        {id:"c4", text:`æŠŠ ${x} è®Šæˆå…©å€`, ok:"none"},
      ]);

      state.l3.match.cards = cards;
      state.l3.match.slots = {A:null, B:null};
    }

    function newQuestion(){
      if(state.level===1){ genL1(); renderL1(); }
      if(state.level===2){ genL2(); renderL2(); }
      if(state.level===3){ genL3(); renderL3(); }
    }

    /* =========================================================
      LEVEL 1ï¼šåˆ†æ•¸ Ã· æ•´æ•¸ï¼ˆé¸æ“‡é¡Œï¼‰
    ========================================================= */
    function renderL1(){
      setGameHeader();
      const {p,q,k, options, pick} = state.l1;

      $("#content").innerHTML = `
        <div class="qbox">
          <div class="qhead">
            <div style="display:flex; gap:10px; align-items:center">
              <span class="badge">9-1</span>
              <div>
                <b>åˆ†æ•¸ Ã· æ•´æ•¸</b>
                <div class="muted small">é¸å‡ºæ­£ç¢ºç­”æ¡ˆï¼ˆè¨˜å¾—åŒ–ç°¡ï¼‰</div>
              </div>
            </div>
            <span class="tag"><i class="fa-solid fa-shuffle"></i> éš¨æ©Ÿ</span>
          </div>

          <div class="equation">
            ${fracHTML(p,q)}
            <span class="op">Ã·</span>
            <span class="box">${k}</span>
            <span class="mini">â†’</span>
            <span class="box" style="min-width:160px; font-weight:900; color:rgba(20,23,47,.85)">ï¼Ÿ</span>
          </div>

          <div class="quick" id="l1Opts">
            ${options.map((f,idx)=>`
              <button class="qbtn ${pick===idx?'sel':''}" data-i="${idx}">
                <span style="font-weight:900">${fracText(f.n,f.d)}</span>
                <small>é»æˆ‘</small>
              </button>
            `).join("")}
          </div>

          <div class="actions">
            <button class="btn good" id="btnL1Check"><i class="fa-solid fa-check"></i> é€å‡º</button>
            <button class="btn soft" id="btnL1Skip"><i class="fa-solid fa-forward"></i> æ›ä¸€é¡Œ</button>
          </div>
        </div>
      `;

      $$("#l1Opts .qbtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(state.mode!=="play" || state.paused) return;
          state.l1.pick = Number(btn.dataset.i);
          beep("good");
          renderL1();
        });
      });

      $("#btnL1Skip").addEventListener("click", ()=>{
        if(state.mode!=="play" || state.paused) return;
        beep("bad");
        newQuestion();
      });

      $("#btnL1Check").addEventListener("click", ()=>{
        if(state.mode!=="play" || state.paused) return;
        if(state.l1.pick==null){
          setToast("bad","é‚„æ²’é¸ç­”æ¡ˆ","å…ˆé¸ä¸€å€‹é¸é …ï¼Œä¸ç„¶æˆ‘æœƒæ›¿ä½ å°·å°¬ä¸‰ç§’ã€‚ğŸ˜Œ");
          beep("bad");
          return;
        }
        const chosen = state.l1.options[state.l1.pick];
        const ok = sameFrac(chosen, state.l1.ans);
        if(ok){
          setToast("good","æ­£ç¢ºï¼",`ä½ æŠŠåˆ†æ¯è®Šé•·çš„é‚£ä¸€æ­¥åšå¾—å¾ˆæ¼‚äº®ã€‚âœ¨`);
          award(true);
          newQuestion();
        }else{
          setToast("bad","å†è©¦ä¸€æ¬¡",`æƒ³ä¸€ä¸‹ï¼šé™¤ä»¥æ•´æ•¸ï¼åˆ†æ¯å†ä¹˜ä¸€æ¬¡ã€‚æŠŠç¯€å¥æŠ“ä½å°±æœƒä¸­ã€‚`);
          award(false);
        }
      });
    }

    /* =========================================================
      LEVEL 2ï¼šæ•´æ•¸ Ã— å¹¾åˆ†ä¹‹å¹¾ï¼ˆé¸æ“‡é¡Œï¼‰
    ========================================================= */
    function renderL2(){
      setGameHeader();
      const {m,a,b, options, pick} = state.l2;

      $("#content").innerHTML = `
        <div class="qbox">
          <div class="qhead">
            <div style="display:flex; gap:10px; align-items:center">
              <span class="badge">9-2</span>
              <div>
                <b>æ•´æ•¸ Ã— å¹¾åˆ†ä¹‹å¹¾</b>
                <div class="muted small">é¸å‡ºæ­£ç¢ºç­”æ¡ˆï¼ˆè¨˜å¾—åŒ–ç°¡ï¼‰</div>
              </div>
            </div>
            <span class="tag"><i class="fa-solid fa-shuffle"></i> éš¨æ©Ÿ</span>
          </div>

          <div class="equation">
            <span class="box">${m}</span>
            <span class="op">Ã—</span>
            ${fracHTML(a,b)}
            <span class="mini">â†’</span>
            <span class="box" style="min-width:160px; font-weight:900; color:rgba(20,23,47,.85)">ï¼Ÿ</span>
          </div>

          <div class="quick" id="l2Opts">
            ${options.map((f,idx)=>`
              <button class="qbtn ${pick===idx?'sel':''}" data-i="${idx}">
                <span style="font-weight:900">${fracText(f.n,f.d)}</span>
                <small>é»æˆ‘</small>
              </button>
            `).join("")}
          </div>

          <div class="actions">
            <button class="btn good" id="btnL2Check"><i class="fa-solid fa-check"></i> é€å‡º</button>
            <button class="btn soft" id="btnL2Skip"><i class="fa-solid fa-forward"></i> æ›ä¸€é¡Œ</button>
          </div>

          <div class="sep"></div>
          <div class="muted small" style="line-height:1.75">
            å°æç¤ºï¼šæ•´æ•¸å¯ä»¥æƒ³æˆ <b>${m}/1</b>ã€‚ä½ åªæ˜¯æŠŠã€Œæ•´å€‹ä¸–ç•Œã€è®Šæˆåˆ†æ•¸è€Œå·²ã€‚ğŸ˜
          </div>
        </div>
      `;

      $$("#l2Opts .qbtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(state.mode!=="play" || state.paused) return;
          state.l2.pick = Number(btn.dataset.i);
          beep("good");
          renderL2();
        });
      });

      $("#btnL2Skip").addEventListener("click", ()=>{
        if(state.mode!=="play" || state.paused) return;
        beep("bad");
        newQuestion();
      });

      $("#btnL2Check").addEventListener("click", ()=>{
        if(state.mode!=="play" || state.paused) return;
        if(state.l2.pick==null){
          setToast("bad","é‚„æ²’é¸ç­”æ¡ˆ","å…ˆé¸ä¸€å€‹é¸é …ï¼Œåˆ¥è®“ç­”æ¡ˆåœ¨é¢¨ä¸­ç­‰ä½ ã€‚ğŸƒ");
          beep("bad");
          return;
        }
        const chosen = state.l2.options[state.l2.pick];
        const ok = sameFrac(chosen, state.l2.ans);
        if(ok){
          setToast("good","æ­£ç¢ºï¼",`ä½ æŠŠæ•´æ•¸è·Ÿåˆ†å­ç‰½æ‰‹ç‰½å¾—å¾ˆè‡ªç„¶ã€‚âœ¨`);
          award(true);
          newQuestion();
        }else{
          setToast("bad","å†è©¦ä¸€æ¬¡",`æƒ³ä¸€ä¸‹ï¼šå…ˆæŠŠæ•´æ•¸è·Ÿåˆ†å­ç›¸ä¹˜ï¼Œå†åŒ–ç°¡ã€‚ç©©ä½ä½ å°±è´ã€‚`);
          award(false);
        }
      });
    }

    /* =========================================================
      LEVEL 3ï¼šæ‹–æ‹‰é…å°ï¼ˆä¿ç•™ï¼‰
    ========================================================= */
    function renderL3(){
      setGameHeader();
      const x = state.l3.x;
      const half = x/2;
      const cards = state.l3.match.cards;
      const slots = state.l3.match.slots;

      const cardUI = cards.map(c=>`
        <div class="btn ghost l3card" data-id="${c.id}" style="justify-content:flex-start; cursor:grab">
          <i class="fa-solid fa-hand-pointer"></i> ${escapeHtml(c.text)}
        </div>
      `).join("");

      const slotA = slots.A ? escapeHtml(cards.find(c=>c.id===slots.A)?.text || "") : "æ‹–åˆ°é€™è£¡";
      const slotB = slots.B ? escapeHtml(cards.find(c=>c.id===slots.B)?.text || "") : "æ‹–åˆ°é€™è£¡";

      $("#content").innerHTML = `
        <div class="qbox">
          <div class="qhead">
            <div style="display:flex; gap:10px; align-items:center">
              <span class="badge">9-3</span>
              <div>
                <b>æ‹–æ‹‰æ¨¡å¼ï½œèªæ„â†’ç®—å¼ä½ç½®</b>
                <div class="muted small">æŠŠå·¦é‚Šå¡ç‰‡æ‹–åˆ°å³é‚Šã€ŒÃ— 1/2ã€æˆ–ã€ŒÃ· 2ã€</div>
              </div>
            </div>
            <span class="tag"><i class="fa-solid fa-shuffle"></i> éš¨æ©Ÿ</span>
          </div>

          <div class="equation">
            <span class="box">${x}</span>
            <span class="op">Ã—</span>
            ${fracHTML(1,2)}
            <span class="mini">èˆ‡</span>
            <span class="box">${x}</span>
            <span class="op">Ã·</span>
            <span class="box">2</span>
          </div>

          <div class="introGrid" style="grid-template-columns:1fr 1fr; margin-top:14px">
            <div class="panel">
              <h3>èªæ„å¡ç‰‡ï¼ˆæ‹–æ‹‰ï¼‰</h3>
              <div class="muted small">æŠ“ä½å¡ç‰‡æ‹–éå»ï¼ŒåƒæŠŠæ„æ€å¡é€²å°çš„ä½ç½®ã€‚</div>
              <div class="actions" style="margin-top:10px" id="l3CardArea">${cardUI}</div>
            </div>

            <div class="panel">
              <h3>é…å°æ§½</h3>
              <div class="muted small">æ‹–åˆ°æ§½ä½å°±æœƒæ”¾ä¸Šå»ã€‚</div>

              <div class="slotRow">
                <div class="slot ${slots.A?'filled':''}" id="slotMul" data-slot="A">
                  <div style="text-align:center">
                    <div style="font-weight:900; color:rgba(20,23,47,.75)">Ã— 1/2</div>
                    <div class="muted small" style="margin-top:4px">${slotA}</div>
                  </div>
                </div>

                <div class="slot ${slots.B?'filled':''}" id="slotDiv" data-slot="B">
                  <div style="text-align:center">
                    <div style="font-weight:900; color:rgba(20,23,47,.75)">Ã· 2</div>
                    <div class="muted small" style="margin-top:4px">${slotB}</div>
                  </div>
                </div>
              </div>

              <div class="actions">
                <button class="btn good" id="btnMatchCheck"><i class="fa-solid fa-check"></i> é€å‡º</button>
                <button class="btn soft" id="btnMatchReset"><i class="fa-solid fa-rotate-left"></i> é‡ç½®</button>
              </div>

              <div class="sep"></div>
              <div class="muted small" style="line-height:1.7">
                çµæœéƒ½å¯èƒ½æ˜¯ <b>${half}</b>ï¼Œä½†ä½ è¦é…å°çš„æ˜¯ã€Œæ„æ€ã€ã€‚
              </div>
            </div>
          </div>
        </div>
      `;

      attachL3Drag();
    }

    function attachL3Drag(){
      const slotMul = $("#slotMul");
      const slotDiv = $("#slotDiv");
      if(!slotMul || !slotDiv) return;

      function setSlotActive(activeEl){
        [slotMul, slotDiv].forEach(s=>s.classList.toggle("active", s===activeEl));
      }

      function onPointerDown(e){
        if(state.level!==3) return;
        if(state.mode!=="play" || state.paused) return;

        const el = e.currentTarget;
        const id = el.dataset.id;
        if(!id) return;

        e.preventDefault();

        const ghost = document.createElement("div");
        ghost.className = "ghostDrag";
        ghost.textContent = "å¡";
        document.body.appendChild(ghost);

        const move = (ev)=>{
          ghost.style.left = ev.clientX + "px";
          ghost.style.top = ev.clientY + "px";

          const hit = document.elementFromPoint(ev.clientX, ev.clientY);
          const inMul = hit && hit.closest && hit.closest("#slotMul");
          const inDiv = hit && hit.closest && hit.closest("#slotDiv");

          if(inMul) setSlotActive(slotMul);
          else if(inDiv) setSlotActive(slotDiv);
          else setSlotActive(null);
        };

        const up = (ev)=>{
          window.removeEventListener("pointermove", move);
          window.removeEventListener("pointerup", up);
          setSlotActive(null);

          const hit = document.elementFromPoint(ev.clientX, ev.clientY);
          const inMul = hit && hit.closest && hit.closest("#slotMul");
          const inDiv = hit && hit.closest && hit.closest("#slotDiv");

          if(inMul){
            state.l3.match.slots.A = id;
            beep("good");
            renderL3();
          }else if(inDiv){
            state.l3.match.slots.B = id;
            beep("good");
            renderL3();
          }else{
            beep("bad");
          }

          ghost.remove();
        };

        window.addEventListener("pointermove", move, {passive:false});
        window.addEventListener("pointerup", up, {passive:false});
        move(e);
      }

      $$("#l3CardArea .l3card").forEach(card=>{
        card.addEventListener("pointerdown", onPointerDown);
      });

      $("#btnMatchReset").addEventListener("click", ()=>{
        if(state.mode!=="play" || state.paused) return;
        state.l3.match.slots = {A:null, B:null};
        beep("bad");
        renderL3();
      });

      $("#btnMatchCheck").addEventListener("click", ()=>{
        if(state.mode!=="play" || state.paused) return;
        const A = state.l3.match.slots.A;
        const B = state.l3.match.slots.B;
        if(!A || !B){
          setToast("bad","é‚„æ²’é…å®Œ","å…©å€‹æ§½éƒ½è¦æ”¾å¡ç‰‡æ‰ç®—ã€‚");
          beep("bad");
          return;
        }

        const map = Object.fromEntries(state.l3.match.cards.map(c=>[c.id, c.ok]));
        const okA = map[A];
        const okB = map[B];

        const goodA = (okA==="mul" || okA==="both");
        const goodB = (okB==="div" || okB==="both");

        if(goodA && goodB){
          setToast("good","æ­£ç¢ºï¼",`ä½ æŠŠã€Œæ‹¿ä¸€åŠã€èˆ‡ã€Œå¹³å‡åˆ†ã€å„è‡ªæ”¾å›å°çš„ä½ç½®ã€‚âœ¨`);
          award(true);
          newQuestion();
        }else{
          setToast("bad","å†è©¦ä¸€æ¬¡","çœ‹èªæ„ï¼šå“ªä¸€å¥æ˜¯ã€Œæ‹¿ä¸€åŠã€ã€å“ªä¸€å¥æ˜¯ã€Œå¹³å‡åˆ†å…©ä»½ã€ã€‚");
          award(false);
        }
      });
    }

    /* =========================================================
      é“å…·ï¼šåªä¿ç•™åŠ å€
    ========================================================= */
    function useDouble(){
      if(state.mode!=="play" || state.paused) return;
      if(state.tools.dbl<=0){
        setToast("bad","åŠ å€ç”¨å®Œäº†","ä½ å·²ç¶“æŠŠåŠ å€ç”¨åˆ°ä¹¾ä¹¾æ·¨æ·¨ã€‚");
        beep("bad");
        return;
      }
      if(state.tools.dblArmed){
        setToast("", "åŠ å€å·²å¾…å‘½", "ä¸‹ä¸€é¡Œæ­£ç¢ºå°±æœƒ <b>Ã—2</b>ï¼Œä¸ç”¨é€£æŒ‰ã€‚");
        beep("good");
        return;
      }
      state.tools.dbl--;
      state.tools.used++;
      state.tools.dblArmed = true;
      setToast("", "åŠ å€ä¸Šè†›", "ä¸‹ä¸€é¡Œç­”å°ï¼š<b>å¾—åˆ† Ã—2</b> âš¡ï¼ˆå¤±èª¤æœƒç†„ç«ï¼‰");
      beep("good");
      updateGameHUD();
    }

    /* =========================================================
      å°ç‰¹æ•ˆï¼šå½©å¸¶ï¼ˆcanvasï¼‰
    ========================================================= */
    const fx = { c: $("#fxCanvas"), ctx: null, parts: [], raf: null };
    function fxResize(){
      const dpr = window.devicePixelRatio || 1;
      fx.c.width = Math.floor(innerWidth * dpr);
      fx.c.height = Math.floor(innerHeight * dpr);
      fx.c.style.width = innerWidth + "px";
      fx.c.style.height = innerHeight + "px";
      fx.ctx = fx.c.getContext("2d");
      fx.ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener("resize", fxResize);

    function fxConfetti(n=18){
      if(!fx.ctx) fxResize();
      for(let i=0;i<n;i++){
        fx.parts.push({
          x: innerWidth*(0.25+Math.random()*0.5),
          y: -10,
          vx: (Math.random()*2-1)*2.2,
          vy: 2 + Math.random()*3.2,
          r: 3 + Math.random()*4,
          a: Math.random()*Math.PI*2,
          va: (Math.random()*2-1)*0.2,
          life: 70 + Math.random()*40
        });
      }
      if(!fx.raf) fxLoop();
    }

    function fxLoop(){
      fx.raf = requestAnimationFrame(fxLoop);
      const ctx = fx.ctx;
      ctx.clearRect(0,0,innerWidth,innerHeight);
      fx.parts = fx.parts.filter(p=>p.life>0);
      for(const p of fx.parts){
        p.life -= 1;
        p.x += p.vx;
        p.y += p.vy;
        p.a += p.va;
        p.vy += 0.06;

        ctx.save();
        ctx.translate(p.x,p.y);
        ctx.rotate(p.a);
        const g = ctx.createLinearGradient(-p.r,0,p.r,0);
        g.addColorStop(0,"rgba(137,68,217,.9)");
        g.addColorStop(1,"rgba(254,86,153,.9)");
        ctx.fillStyle = g;
        ctx.fillRect(-p.r, -p.r*0.6, p.r*2, p.r*1.2);
        ctx.restore();
      }
      if(fx.parts.length===0){
        cancelAnimationFrame(fx.raf);
        fx.raf = null;
        ctx.clearRect(0,0,innerWidth,innerHeight);
      }
    }

    /* =========================================================
      æµç¨‹äº‹ä»¶
    ========================================================= */
    $("#btnGoMenu").addEventListener("click", ()=>{
      const name = ($("#nameInput").value || "").trim();
      if(!name){
        beep("bad");
        $("#nameInput").focus();
        alert("åå­—å¿…å¡«ï¼Œå…ˆè¼¸å…¥åå­—å†é€²å…¥é¸å–®ï½");
        return;
      }
      state.player = name;
      $("#playerName").textContent = state.player;
      showScreen("menu");
      renderMenu();
    });

    $("#nameInput").addEventListener("keydown",(e)=>{
      if(e.key==="Enter") $("#btnGoMenu").click();
    });

    $("#btnStart").addEventListener("click", ()=> startRound());

    $("#btnBackName").addEventListener("click", ()=>{
      showScreen("intro");
      $("#nameInput").value = state.player || "";
      setTimeout(()=>$("#nameInput").focus(), 20);
    });

    $("#btnPause").addEventListener("click", ()=> pauseRound());
    $("#btnResume").addEventListener("click", ()=> resumeRound());
    $("#btnQuit").addEventListener("click", ()=>{
      if(state.mode==="play") pauseRound();
      endRound(false);
    });
    $("#btnQuitNoSave").addEventListener("click", ()=> endRound(false));
    $("#btnRestart").addEventListener("click", ()=> startRound());

    $("#btnPlayAgain").addEventListener("click", ()=>{
      $("#resultOverlay").classList.remove("show");
      startRound();
    });
    $("#btnBackMenu").addEventListener("click", ()=>{
      $("#resultOverlay").classList.remove("show");
      state.mode="menu";
      showScreen("menu");
      renderMenu();
    });

    $("#btnDouble").addEventListener("click", useDouble);

    $("#btnSound").addEventListener("click", ()=>{
      soundOn = !soundOn;
      $("#btnSound").innerHTML = `<i class="fa-solid ${soundOn?'fa-volume-high':'fa-volume-xmark'}"></i><span id="soundText">éŸ³æ•ˆï¼š${soundOn?'é–‹':'é—œ'}</span>`;
    });

    /* =========================================================
      åˆå§‹
    ========================================================= */
    showScreen("intro");
    $("#nameInput").focus();
    updateGameHUD();
    fxResize();

    state.level = 1;
    state.diff = "normal";
  </script>
</body>
</html>
